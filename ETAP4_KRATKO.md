# Этап 4. Архитектура проекта

## Схема пайплайна

```
Пользователь (Telegram)
    ↓
handlers/ [text/voice/image/rag]
    ↓
services/router.py
    ↓
Yandex Cloud API (GPT/SpeechKit/Vision) + RAG (keyword search)
    ↓
Ответ в Telegram
```

## Описание архитектуры

**handlers/** — обрабатывают входящие сообщения от пользователя (текст, голос, изображения, команды), определяют тип запроса и текущий режим бота.

**services/** — сервисный слой для работы с Yandex Cloud API: `yandex_client.py` содержит клиенты для GPT, SpeechKit и Vision, а `router.py` маршрутизирует запросы к нужным сервисам.

**rag/** — модуль базы знаний: индексирует документы (`index_simple.py`), выполняет поиск по ключевым словам и генерирует ответы на основе найденных фрагментов (`query.py`).

**data/** — хранит исходные документы (`documents/`) и проиндексированную базу знаний (`simple_index/`), а также временные файлы (аудио, изображения).

**utils/** — вспомогательные утилиты для логирования, конвертации форматов и управления пользовательскими сессиями.

### Маршрутизация запросов

Handler определяет тип сообщения и передает его в `router.py`, который выбирает нужный сервис (YandexGPT для текста, SpeechKit для голоса, Vision для изображений). В режиме RAG дополнительно выполняется поиск в базе знаний. Результат возвращается через router обратно в handler и отправляется пользователю.

